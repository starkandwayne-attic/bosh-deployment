---
meta:
  openstack:
    auth_url: (( param "Please supply the authentication URL for the Openstack Identity Service" ))
    tenant: (( param "Please supply an Openstack tenant name" ))
    username: (( param "Please supply an Openstack user name" ))
    api_key: (( param "Please supply an Openstack password" ))

cloud_provider:
  mbus: (( concat "https://mbus:mbus-password@" jobs.bosh.networks.default.static_ips.0 ":6868" ))

  template:
    name: openstack_cpi
    release: bosh-openstack-cpi

  ssh_tunnel:
    port: 22
    user: vcap
    host: (( grab jobs.bosh.networks.default.static_ips[0] ))
    private_key: (( param "What is the local path to the Private Key for this deployment?  Due to a bug in Openstack Liberty and Mitaka, you need to use an SSH key generated by ssh-keygen, not one generated by Nova." ))
  properties:
    agent:
      mbus: https://mbus:mbus-password@0.0.0.0:6868
    blobstore:
      path: /var/vcap/micro_bosh/data/cache
      provider: local
    ntp: (( grab meta.ntp ))
    openstack: &openstack
      auth_url: (( grab meta.openstack.auth_url ))
      tenant: (( grab meta.openstack.tenant ))
      username: (( grab meta.openstack.username ))
      api_key: (( grab meta.openstack.api_key ))
      domain: default
      project: (( grab meta.openstack.tenant ))
      default_key_name: (( param "What is your full key name?" ))
      default_security_groups: (( param "What Security Groups?" ))

properties:
  director:
    cpi_job: openstack_cpi
  openstack: (( grab cloud_provider.properties.openstack ))
